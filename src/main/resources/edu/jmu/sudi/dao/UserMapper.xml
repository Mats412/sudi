<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.jmu.sudi.dao.UserMapper">

    <!-- 根据用户名查询用户信息 -->
    <select id="findUserByUsername" resultType="edu.jmu.sudi.entity.UserEntity">
        select * from sudi_user where username=#{username}
    </select>

    <!-- 设置用户登录成功后的信息记录 -->
    <update id="setLoginSuccessInfo">
        update sudi_user set lastLoginTime=NOW(), loginCount=loginCount+1 where userId=#{userId}
    </update>

    <!-- 设置用户退出登录后的信息记录 -->
    <update id="setLogoutSuccessInfo">
        update sudi_user set lastLogoutTime=NOW() where userId=#{userId}
    </update>

    <!-- 根据页面条件查询用户列表 -->
    <select id="findUserListByPage" resultType="edu.jmu.sudi.entity.UserEntity" parameterType="edu.jmu.sudi.vo.UserVo">
        select * from sudi_user
        <where>
            <if test="userId!=null"> and userId=#{userId} </if>
            <if test="username!=null and username!=''"> and username like concat('%', #{username}, '%') </if>
            <if test="phone!=null and phone!=''"> and phone like concat('%', #{phone}, '%') </if>
            <if test="email!=null and email!=''"> and email like concat('%', #{email}, '%') </if>
            <if test="gender!=null"> and gender=#{gender} </if>
        </where>
    </select>

    <!-- 后台添加用户 -->
    <insert id="addUser" parameterType="edu.jmu.sudi.vo.UserVo">
        insert into sudi_user (username, password, phone, email, birthday, <if test="gender!=null">gender,</if> registerDate)
        values(#{username}, #{password}, #{phone}, #{email}, #{birthday}, <if test="gender!=null">#{gender},</if> NOW())
    </insert>

    <!-- 后台修改用户信息 -->
    <update id="modifyUserBackstage" parameterType="edu.jmu.sudi.vo.UserVo">
        update sudi_user
        <set>
            <if test="username!=null and username!=''"> username=#{username}, </if>
            <if test="phone!=null and phone!=''"> phone=#{phone}, </if>
            <if test="birthday!=null"> birthday=#{birthday}, </if>
            <if test="email!=null"> email=#{email}, </if>
            <if test="gender!=null"> gender=#{gender}, </if>
        </set>
        where userId=#{userId}
    </update>

    <!-- 重置用户密码 -->
    <update id="resetPassword">
        update sudi_user set password=#{newPassword} where userId=#{userId}
    </update>
</mapper>